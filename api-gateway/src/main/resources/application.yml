server:
  port: 9100

spring:
  application:
    name: api-gateway
  main:
    web-application-type: reactive
  cloud:
    gateway:
      default-filters:
        - name: GlobalFilter
          args:
            baseMessage: Spring Cloud Gateway GlobalFilter
            preLogger: true
            postLogger: true
      routes:
        - id: auth-api-login
          uri: lb://AUTH-API # eureka에 등록된 서비스 이름
          predicates:
            - Path=/auth/login
            - Method=POST
          filters:
            - RewritePath=/auth/(?<segment>.*), /$\{segment}
        - id: auth-api-logout
          uri: lb://AUTH-API # eureka에 등록된 서비스 이름
          predicates:
            - Path=/auth/logout
            - Method=POST
          filters:
            - RewritePath=/auth/(?<segment>.*), /$\{segment}
        - id: auth-api-check
          uri: lb://AUTH-API # eureka에 등록된 서비스 이름
          predicates:
            - Path=/auth/auth_check
            - Method=GET
          filters:
            - RewritePath=/auth/(?<segment>.*), /$\{segment}
        - id: auth-api
          uri: lb://AUTH-API # eureka에 등록된 서비스 이름
          predicates:
            - Path=/auth/**
            - Method=GET
          filters:
            - AddRequestHeader=auth-api-request, auth-api-request-header
            - AddResponseHeader=auth-api-response, auth-api-response-header
            - name: CustomFilter
#            - name: BackofficeAuthFilter
            - name: LoggingFilter
              args:
                baseMessage: Hi, there.
                preLogger: true
                postLogger: true
            - RewritePath=/auth/(?<segment>.*), /$\{segment}
        - id: system-api
          uri: lb://SYSTEM-API
          predicates:
            - Path=/sys/**
          filters:
            - CustomFilter
#            - BackofficeAuthFilter
            - RewritePath=/sys/(?<segment>.*), /$\{segment}
        - id: product-api
          uri: lb://PRODUCT-API
          predicates:
            - Path=/prd/**
          filters:
            - CustomFilter
#            - BackofficeAuthFilter
            - RewritePath=/prd/(?<segment>.*), /$\{segment}
        - id: backoffice
          uri: lb://BACKOFFICE
          predicates:
            - Path=/**
            - Host=back-office.com*
#          filters:
#            - RewritePath=/(?<segment>.*), /$\{segment}
        - id: backoffice-nuxt
          uri: http://localhost:3000
          predicates:
            - Path=/**
            - Host=back-office-nuxt.com*

eureka:
  client:
    register-with-eureka: true        # eureka 서비스 등록 여부
    fetch-registry: true              # 
#    registry-fetch-interval-seconds: 15  # eureka에게 서비스 정보를 가져오는 주기
    disable-delta: true               # eureka에게 서비스 정보를 가져올때 변경된 내용만 가져온다. (false로 하면 전체를 가져오기에 대역폭 낭비)
    service-url:
      defaultZone: http://admin:admin123@localhost:9000/eureka/

logging:
  level:
    com.msa: DEBUG

## actuator
#management:
#  endpoints:
#    web:
#      exposure:
#        include: "gateway" # http://localhost:9000/actuator/gateway/routes
#  endpoint:
#    gateway:
#      enabled: true
#    health:
#      show-details: always  # actuator에서 상세한 정보들을 확인하기 위해 설정